"use strict";function loadImages(){imageCollection.fetch({change:!0}).done(function(){imageCollection.each(function(a){new ThumbnailView({model:a})})})}function displayImage(){$(".image-file-name").val($(".image-file-selector").val());var a=$(".image-file-selector")[0],b=a.files[0],c=new FileReader;c.onload=function(a){$(".image-detail").attr("src",a.target.result)},c.readAsDataURL(b)}Parse.initialize("TJwmttIazJ3YEVm0bEW5KdReglYz0ViHpygK8y40","9rTc1AIV0UHOIbaM8TMZBngR0H8ZzI6DOOzTXgwo");var Image=Parse.Object.extend({className:"Image"}),ImageCollection=Parse.Collection.extend({model:Image}),ThumbnailView=Parse.View.extend({className:"thumbnail",thumbnailTemplate:_.template($(".thumbnail-template").text()),events:{click:"showDetailView"},initialize:function(){this.model.on("change",this.render.bind(this)),this.model.on("destroy",this.remove.bind(this)),$(".image-gallery").prepend(this.el),this.render()},render:function(){var a=this.thumbnailTemplate(this.model.attributes);this.$el.html(a)},showDetailView:function(){new DetailView({model:this.model})}}),DetailView=Parse.View.extend({className:"detail",detailTemplate:_.template($(".detail-template").text()),events:{"click .select-button":"select","click .filter-button":"filter","click .upload-button":"upload","click .cancel-button":"reset","click .update-button":"update","click .delete-button":"destroy"},initialize:function(){$(".image-form").html(""),$(".image-form").append(this.el),this.render()},render:function(){var a=this.detailTemplate(this.model.attributes);return this.$el.html(a),this},reset:function(){this.remove(),new DetailView({model:placeholderModel})},select:function(){$(".image-file-selector").click()},filter:function(){$(".image-filter-overlay").fadeIn("slow"),$(".image-filter-options").fadeIn("slow"),$(".radio-button").click(function(){$(".image-filter-options").fadeOut("slow"),$(".image-filter-overlay").fadeOut("slow"),$(".image-detail").hide(),$(".detail").prepend('<canvas id="canvas" width="'+$(".image-detail").width()+'" height="'+$(".image-detail").height()+'"></canvas>');var a=new FileReader,b=$(".image-file-selector")[0].files[0],c="";a.onload=function(a){var b=new fabric.Canvas("canvas"),d=$("input:radio[name=filter-type]:checked").val();c=a.target.result,fabric.Image.fromURL(c,function(a){switch(d){case"grayscale":a.filters.push(new fabric.Image.filters.Grayscale);break;case"invert":a.filters.push(new fabric.Image.filters.Invert);break;case"sepia":a.filters.push(new fabric.Image.filters.Sepia);break;case"none":a.filters.push([])}a.setHeight($(".image-detail").height()),a.setWidth($(".image-detail").width()),a.applyFilters(b.renderAll.bind(b)),b.add(a).setActiveObject(a).renderAll()})},b?a.readAsDataURL(b):console.log("NON-LOCAL FILE NOT READY YET!");var d=new Parse.File("photo.jpg",{base64:c.replace(/^data:image\/(png|jpg);base64,/,"")});console.log("objParseFile",d)})},upload:function(){var a=this.parseFile();if(a){$(".loading").show();var b=new Image;b.save({image:a,comment:$(".image-comment").val(),isPlaceholder:!1},{success:function(){$(".loading").hide(),new ThumbnailView({model:b})},error:function(){console.log("There was an issue with saving the image!")}}),this.remove(),this.reset()}},update:function(){var a=this.parseFile();a&&($(".loading").show(),"unchanged"===a?this.model.set({comment:this.$el.find(".image-comment").val()}).save({success:function(){$(".loading").hide()},error:function(){console.log("There was an issue with updating the comment!")}}):this.fileUploadPromise.done(function(){this.model.set({image:a,comment:this.$el.find(".image-comment").val()}).save({success:function(){$(".loading").hide()},error:function(){console.log("There was an issue with updating the image!")}})}.bind(this)),this.remove(),this.reset())},parseFile:function(){var a=$(".image-file-selector")[0];if(a.files.length>0){var b=a.files[0],c=$(".image-file-selector").val().split("\\").pop().split("/").pop(),d=new Parse.File(c,b);return this.fileUploadPromise=d.save(),d}return""!==$(".image-file-name").val()?"unchanged":(alert("You must select a file to upload!"),!1)},destroy:function(){this.model.destroy(),this.reset()}}),imageCollection=new ImageCollection,placeholderModel=new Image({image:{_url:"/parse-intro/images/3914f4d5.placeholder-image.png"},comment:"",isPlaceholder:!0});new DetailView({model:placeholderModel}),loadImages(),$(document).on("change",".image-file-selector",displayImage);